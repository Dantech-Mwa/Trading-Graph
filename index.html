<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Elite Live Crypto & NFT Dashboard</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-date-fns"></script>
  <script src="https://cdn.jsdelivr.net/npm/chartjs-chart-financial@0.2.1"></script>
  <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.9.3/dist/confetti.browser.min.js"></script>
  <style>
    :root {
      --bg: #0f0f1a;
      --card: rgba(20, 20, 40, 0.7);
      --glass: rgba(255, 255, 255, 0.05);
      --text: #e0e0ff;
      --green: #00ff88;
      --red: #ff3b5c;
      --accent: #00d4ff;
      --gold: #ffd700;
      --purple: #aa00ff;
      --orange: #ff8800;
      --shadow: 0 8px 32px rgba(0,0,0,0.4);
      --transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    }
    [data-theme="light"] {
      --bg: #f8f9ff;
      --card: rgba(255, 255, 255, 0.9);
      --glass: rgba(255, 255, 255, 0.7);
      --text: #1a1a2e;
      --green: #00c853;
      --red: #d50000;
      --accent: #2962ff;
    }
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body {
      background: var(--bg);
      color: var(--text);
      font-family: 'Inter', 'Segoe UI', sans-serif;
      padding: 12px;
      transition: var(--transition);
      min-height: 100vh;
      background: linear-gradient(135deg, #0f0f1a 0%, #1a1a2e 100%);
    }
    [data-theme="light"] body { background: linear-gradient(135deg, #e3f2fd 0%, #bbdefb 100%); }
    .container { max-width: 1400px; margin: 0 auto; }
    .header {
      text-align: center;
      margin-bottom: 16px;
      backdrop-filter: blur(10px);
      background: var(--glass);
      border-radius: 16px;
      padding: 12px;
      border: 1px solid rgba(255,255,255,0.1);
    }
    h1 {
      font-size: clamp(1.4rem, 5vw, 2rem);
      font-weight: 800;
      background: linear-gradient(90deg, var(--green), var(--accent));
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      margin-bottom: 4px;
    }
    .ticker {
      font-size: clamp(1.6rem, 6vw, 2.4rem);
      font-weight: 900;
      letter-spacing: 1px;
      text-shadow: 0 0 20px rgba(0,212,170,0.5);
      animation: pulse 2s infinite;
    }
    @keyframes pulse {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.8; }
    }
    .status {
      font-size: 0.9rem;
      color: var(--accent);
      font-weight: 500;
    }
    .trading-buttons {
      display: flex; justify-content: center; gap: 12px; margin: 12px 0;
    }
    .btn {
      padding: 10px 20px;
      border: none;
      border-radius: 12px;
      font-weight: bold;
      cursor: pointer;
      transition: var(--transition);
      box-shadow: var(--shadow);
    }
    .btn-buy { background: var(--green); color: white; }
    .btn-sell { background: var(--red); color: white; }
    .btn:hover { transform: scale(1.05); box-shadow: 0 0 20px currentColor; }
    .chart-box {
      background: var(--card);
      border-radius: 20px;
      padding: 16px;
      margin-bottom: 16px;
      box-shadow: var(--shadow);
      backdrop-filter: blur(12px);
      border: 1px solid rgba(255,255,255,0.1);
      position: relative;
      overflow: hidden;
      opacity: 0;
      animation: fadeIn 1s ease-in forwards;
    }
    @keyframes fadeIn { to { opacity: 1; } }
    .chart-box::before {
      content: '';
      position: absolute;
      top: 0; left: 0; right: 0;
      height: 3px;
      background: linear-gradient(90deg, var(--green), var(--accent), var(--purple));
      animation: shimmer 3s infinite;
    }
    @keyframes shimmer {
      0% { transform: translateX(-100%); }
      100% { transform: translateX(100%); }
    }
    #tradingview-chart { width: 100%; height: 400px; border-radius: 12px; }
    .marquee {
      background: var(--glass);
      padding: 12px;
      border-radius: 16px;
      overflow: hidden;
      white-space: nowrap;
      font-size: 0.95rem;
      margin: 16px 0;
      border: 1px solid rgba(255,255,255,0.1);
    }
    .marquee-content {
      display: inline-block;
      animation: scroll 30s linear infinite;
    }
    @keyframes scroll {
      0% { transform: translateX(0); }
      100% { transform: translateX(-50%); }
    }
    .asset-item {
      display: inline-block;
      margin-right: 32px;
      font-weight: 600;
    }
    .asset-name { color: var(--gold); }
    .asset-price { color: var(--text); }
    .asset-change { font-size: 0.8rem; }
    .nft-item { color: var(--purple); }
    .wallet-btn {
      position: fixed; top: 20px; right: 20px;
      padding: 8px 16px;
      background: var(--accent);
      color: white;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      transition: var(--transition);
    }
    .wallet-btn:hover { background: var(--purple); }
    .modal {
      display: none; position: fixed; z-index: 1000; left: 0; top: 0; width: 100%; height: 100%;
      background: rgba(0,0,0,0.5); backdrop-filter: blur(5px);
    }
    .modal-content { background: var(--card); margin: 15% auto; padding: 20px; border-radius: 12px; width: 80%; max-width: 400px; text-align: center; }
    .close { color: #aaa; float: right; font-size: 28px; font-weight: bold; cursor: pointer; }
    .close:hover { color: var(--text); }
    .footer {
      text-align: center;
      margin: 24px 0 12px;
      font-size: 0.8rem;
      color: #888;
      font-style: italic;
    }
    /* Mobile */
    @media (max-width: 768px) {
      .chart-box { padding: 12px; margin-bottom: 12px; }
      #tradingview-chart { height: 300px; }
      .trading-buttons { flex-direction: column; align-items: center; }
      .marquee { font-size: 0.85rem; }
      .asset-item { margin-right: 20px; }
      .wallet-btn { top: 10px; right: 10px; padding: 6px 12px; font-size: 0.9rem; }
    }
    @media (max-width: 480px) {
      #tradingview-chart { height: 250px; }
    }
  </style>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800;900&display=swap" rel="stylesheet">
</head>
<body>
  <button class="wallet-btn" onclick="connectWallet()">Connect Wallet</button>

  <div class="container">
    <div class="header">
      <h1>Elite Live Crypto & NFT Dashboard</h1>
      <div class="ticker" id="livePrice">Loading...</div>
      <div class="status" id="status">Initializing pro systems...</div>
      <div class="trading-buttons">
        <button class="btn btn-buy" onclick="simulateTrade('buy')">ðŸŸ¢ Buy BNB</button>
        <button class="btn btn-sell" onclick="simulateTrade('sell')">ðŸ”´ Sell BNB</button>
      </div>
    </div>

    <div class="chart-box">
      <!-- TradingView Advanced Chart Widget -->
      <div class="tradingview-widget-container">
        <div id="tradingview-chart"></div>
        <script type="text/javascript" src="https://s3.tradingview.com/tv.js"></script>
        <script type="text/javascript">
          new TradingView.widget({
            "width": "100%",
            "height": "400",
            "symbol": "BINANCE:BNBUSDT",
            "interval": "60",
            "timezone": "Etc/UTC",
            "theme": "dark",
            "style": "1",
            "locale": "en",
            "toolbar_bg": "#f1f3f6",
            "enable_publishing": false,
            "allow_symbol_change": true,
            "container_id": "tradingview-chart"
          });
        </script>
      </div>
    </div>

    <div class="chart-box"><canvas id="volumeChart"></canvas></div>
    <div class="chart-box"><canvas id="rsiChart"></canvas></div>
    <div class="chart-box"><canvas id="macdChart"></canvas></div>

    <div class="marquee">
      <div class="marquee-content" id="tickerTape"></div>
    </div>

    <div class="footer">
      TradingView Widget â€¢ Binance WebSocket â€¢ NFT via CoinGecko â€¢ EMA WMA HMA RSI MACD â€¢ Trade Demo
    </div>
  </div>

  <!-- Trade Modal -->
  <div id="tradeModal" class="modal">
    <div class="modal-content">
      <span class="close" onclick="closeModal()">&times;</span>
      <h2 id="modalTitle">Trade Executed</h2>
      <p id="modalMessage">Simulated buy/sell on Binance. Check your wallet!</p>
    </div>
  </div>

  <script>
  // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  // CONFIG
  // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  const MAIN_SYMBOL   = "BNBUSDT";
  const INTERVAL      = "1h";
  const LIMIT         = 150;               // candles for volume/RSI/MACD
  const POLL_PRICE_MS = 5000;              // live price
  const POLL_TICKER_MS= 10000;             // 10-crypto marquee
  const POLL_NFT_MS   = 60000;             // NFT floor prices

  const ANCHOR_PRICES = {
    BTC:51000, ETH:2900, BNB:350, ADA:0.52,
    SOL:105,   DOT:7.2,  DOGE:0.12, XRP:0.58,
    LTC:72,    LINK:15.8
  };

  const NFT_COLLECTIONS = ['boredapeyachtclub','cryptopunks','azuki'];

  // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  // STATE
  // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  let priceData   = [];   // [{x, o, h, l, c}]
  let volumeData  = [];   // [{x, y}]
  let lastPrice   = 0;
  let volumeChart, rsiChart, macdChart;

  // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  // INDICATOR HELPERS (unchanged â€“ only used on the fetched candles)
  // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  const ema = (data, period) => {
    const k = 2/(period+1); let v = data[0].c;
    const out = [v];
    for (let i=1;i<data.length;i++) { v = data[i].c*k + v*(1-k); out.push(v); }
    return out;
  };
  const wma = (data, period) => {
    const w = Array.from({length:period},(_,i)=>i+1);
    const sumW = w.reduce((a,b)=>a+b,0);
    const out = [];
    for (let i=period-1;i<data.length;i++) {
      let s=0; for (let j=0;j<period;j++) s += data[i-j].c * w[j];
      out.push(s/sumW);
    }
    return out;
  };
  const rsi = (data, period=14) => {
    if (data.length < period+1) return [];
    let g=0,l=0;
    for (let i=1;i<=period;i++){ const d=data[i].c-data[i-1].c; d>0?g+=d:l-=d; }
    let ag=g/period, al=l/period;
    const out = [100-(100/(1+ag/(al||1)))];
    for (let i=period+1;i<data.length;i++){
      const d=data[i].c-data[i-1].c;
      const gain = d>0?d:0, loss = d<0?-d:0;
      ag = (ag*(period-1)+gain)/period;
      al = (al*(period-1)+loss)/period;
      out.push(100-(100/(1+ag/(al||1))));
    }
    return out;
  };
  const macd = (data, fast=12, slow=26, sig=9) => {
    const ef = ema(data,fast), es = ema(data,slow);
    const m = ef.slice(-es.length).map((v,i)=>v-es[i]);
    const signal = ema(m.map((v,i)=>({c:v,x:data[i+slow].x})),sig);
    const hist = signal.map((v,i)=>m[i+slow-fast]-v);
    return {macd:m.slice(-signal.length), signal, hist};
  };

  // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  // CHART.JS INITIALISATION (volume / RSI / MACD)
  // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  function initSubCharts() {
    const common = {
      responsive:true, maintainAspectRatio:false,
      plugins:{legend:{display:false}},
      animation:false
    };
    volumeChart = new Chart('volumeChart',{
      type:'bar', data:{datasets:[{data:[]}]}, options:common
    });
    rsiChart = new Chart('rsiChart',{
      type:'line', data:{datasets:[
        {data:[],borderColor:'#aa00ff',fill:true,backgroundColor:'rgba(170,0,255,0.1)',tension:.3},
        {data:[],borderDash:[5],pointRadius:0},
        {data:[],borderDash:[5],pointRadius:0}
      ]}, options:{...common, scales:{y:{min:0,max:100}}}
    });
    macdChart = new Chart('macdChart',{
      type:'bar', data:{datasets:[
        {data:[],backgroundColor:c=>c.raw.y>=0?'#00d4aa':'#ff5252'},
        {data:[],type:'line',borderColor:'#00aaff',pointRadius:0},
        {data:[],type:'line',borderColor:'#ffaa00',pointRadius:0}
      ]}, options:common
    });
  }

  // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  // LOAD HISTORICAL CANDLES (once â€“ HTTPS)
  // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  async function loadHistorical() {
    setStatus('Fetching candlesâ€¦','#ffd700');
    try{
      const r = await fetch(`https://api.binance.com/api/v3/klines?symbol=${MAIN_SYMBOL}&interval=${INTERVAL}&limit=${LIMIT}`);
      const klines = await r.json();

      priceData = klines.map(k=>({
        x:new Date(k[0]),
        o:+k[1], h:+k[2], l:+k[3], c:+k[4]
      }));
      volumeData = klines.map(k=>({x:new Date(k[0]), y:+k[5]}));

      // volume
      volumeChart.data.datasets[0].data = volumeData;
      volumeChart.update();

      // RSI
      const rsiVals = rsi(priceData,14).map((v,i)=>({x:priceData[i+14].x, y:v}));
      rsiChart.data.datasets[0].data = rsiVals;
      rsiChart.data.datasets[1].data = rsiVals.map(d=>({x:d.x,y:70}));
      rsiChart.data.datasets[2].data = rsiVals.map(d=>({x:d.x,y:30}));
      rsiChart.update();

      // MACD
      const {macd:ml, signal:sl, hist:hist} = macd(priceData);
      const macdX = priceData.slice(-hist.length).map(d=>d.x);
      macdChart.data.datasets[0].data = hist.map((v,i)=>({x:macdX[i],y:v}));
      macdChart.data.datasets[1].data = ml.map((v,i)=>({x:macdX[i],y:v}));
      macdChart.data.datasets[2].data = sl.map((v,i)=>({x:macdX[i],y:v}));
      macdChart.update();

      lastPrice = priceData[priceData.length-1].c;
      updateLivePrice(lastPrice);
      setStatus('LIVE â€¢ All systems active','#00ff88');
    }catch(e){
      setStatus('Retry in 5 sâ€¦','#ff5252');
      setTimeout(loadHistorical,5000);
    }
  }

  // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  // LIVE BNB PRICE (polling fallback)
  // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  function startLivePrice() {
    const poll = async () => {
      try{
        const r = await fetch(`https://api.binance.com/api/v3/ticker/price?symbol=${MAIN_SYMBOL}`);
        const d = await r.json();
        updateLivePrice(+d.price);
      }catch(e){/* ignore */ }
    };
    poll(); setInterval(poll,POLL_PRICE_MS);
  }

  // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  // MARQUEE â€“ 10 CRYPTOS (polling)
  // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  function startCryptoTicker() {
    const symbols = Object.keys(ANCHOR_PRICES).map(s=>`${s}USDT`).join('","');
    const poll = async () => {
      try{
        const r = await fetch(`https://api.binance.com/api/v3/ticker/price?symbols=["${symbols}"]`);
        const list = await r.json();
        list.forEach(p=>{
          const sym = p.symbol.replace('USDT','');
          if(!ANCHOR_PRICES[sym]) return;
          const change = ((p.price-ANCHOR_PRICES[sym])/ANCHOR_PRICES[sym])*100;
          updateMarquee(sym, p.price, change);
        });
      }catch(e){/* ignore */ }
    };
    poll(); setInterval(poll,POLL_TICKER_MS);
  }

  // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  // MARQUEE â€“ NFT FLOOR PRICES (CoinGecko)
  // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  function startNFTTicker() {
    const poll = async () => {
      try{
        const r = await fetch(`https://api.coingecko.com/api/v3/nfts/markets?vs_currency=usd&ids=${NFT_COLLECTIONS.join(',')}`);
        const list = await r.json();
        list.forEach(n=>{
          const name = n.name.split(' ')[0].toUpperCase();
          const price = n.floor_price?.usd||0;
          const change = (Math.random()*10-5);
          updateMarquee(`${name}_NFT`, price, change, true);
        });
      }catch(e){/* ignore */ }
    };
    poll(); setInterval(poll,POLL_NFT_MS);
  }

  // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  // MARQUEE HELPER
  // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  function updateMarquee(sym, price, change, isNFT=false){
    let el = document.getElementById(`m-${sym}`);
    if(!el){
      el = document.createElement('span');
      el.id = `m-${sym}`;
      el.className = `asset-item ${isNFT?'nft-item':''}`;
      document.getElementById('tickerTape').appendChild(el);
      document.getElementById('tickerTape').appendChild(el.cloneNode(true));
    }
    const fmt = isNFT?0:(sym==='ADA'||sym==='DOGE'?4:2);
    el.innerHTML = `<span class="asset-name">${sym}</span> <span class="asset-price">$${Number(price).toFixed(fmt)}</span> <span class="asset-change" style="color:${change>=0?'#00ff88':'#ff5252'}">${change>=0?'+' : ''}${change.toFixed(2)}%</span> `;
  }

  // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  // LIVE PRICE DISPLAY
  // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  function updateLivePrice(p){
    const change = ((p-ANCHOR_PRICES.BNB)/ANCHOR_PRICES.BNB)*100;
    const el = document.getElementById('livePrice');
    el.textContent = `$${p.toFixed(2)} ${change>=0?'+' : ''}${change.toFixed(2)}%`;
    el.style.color = change>=0?'#00ff88':'#ff5252';
    if(Math.abs(p-lastPrice)>0.01){
      el.style.transform='scale(1.05)';
      setTimeout(()=>el.style.transform='scale(1)',200);
    }
    lastPrice = p;
  }

  function setStatus(txt,col){
    const el = document.getElementById('status');
    el.textContent = txt;
    el.style.color = col;
  }

  // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  // TRADE BUTTONS / MODAL / CONFIRM
  // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  function simulateTrade(action){
    confetti({particleCount:100,spread:70,origin:{y:.6}});
    document.getElementById('modalTitle').textContent = `${action.toUpperCase()} BNB Executed`;
    document.getElementById('modalMessage').innerHTML = `Simulated ${action} on <a href="https://www.binance.com/en/trade/BNB_USDT" target="_blank">Binance</a>.`;
    document.getElementById('tradeModal').style.display='block';
  }
  function closeModal(){ document.getElementById('tradeModal').style.display='none'; }
  function connectWallet(){ alert('MetaMask connected (demo)'); }

  // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  // THEME DETECTION
  // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  function detectTheme(){
    const dark = window.matchMedia('(prefers-color-scheme: dark)').matches;
    document.documentElement.setAttribute('data-theme', dark?'dark':'light');
  }

  // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  // BOOTSTRAP
  // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  window.onload = () => {
    detectTheme();
    window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change',detectTheme);
    initSubCharts();
    loadHistorical().then(()=>{
      startLivePrice();
      startCryptoTicker();
      startNFTTicker();
    });
    window.onclick = e=>{ if(e.target.classList.contains('modal')) closeModal(); };
  };
</script>
</body>
</html>
