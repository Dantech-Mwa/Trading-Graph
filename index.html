<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Elite Live Crypto & NFT Dashboard</title>

  <!-- TradingView Widget -->
  <script src="https://s3.tradingview.com/tv.js"></script>

  <!-- Chart.js + Financial + Date Adapter -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-date-fns"></script>
  <script src="https://cdn.jsdelivr.net/npm/chartjs-chart-financial@0.2.1"></script>

  <!-- Confetti for Buy/Sell -->
  <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.9.3/dist/confetti.browser.min.js"></script>

  <!-- Google Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800;900&display=swap" rel="stylesheet">

  <style>
    :root {
      --bg: #0f0f1a;
      --card: rgba(20, 20, 40, 0.85);
      --glass: rgba(255, 255, 255, 0.06);
      --text: #e0e0ff;
      --green: #00ff88;
      --red: #ff3b5c;
      --accent: #00d4ff;
      --gold: #ffd700;
      --purple: #aa00ff;
      --shadow: 0 8px 32px rgba(0, 0, 0, 0.4);
      --transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    }
    [data-theme="light"] {
      --bg: #f8f9ff;
      --card: rgba(255, 255, 255, 0.95);
      --text: #1a1a2e;
      --green: #00c853;
      --red: #d50000;
      --accent: #2962ff;
    }
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body {
      background: var(--bg);
      color: var(--text);
      font-family: 'Inter', 'Segoe UI', sans-serif;
      padding: 12px;
      min-height: 100vh;
      transition: var(--transition);
      background: linear-gradient(135deg, #0f0f1a 0%, #1a1a2e 100%);
    }
    [data-theme="light"] body { background: linear-gradient(135deg, #e3f2fd 0%, #bbdefb 100%); }
    .container { max-width: 1400px; margin: 0 auto; }

    /* Header */
    .header {
      text-align: center;
      margin-bottom: 16px;
      backdrop-filter: blur(10px);
      background: var(--glass);
      border-radius: 16px;
      padding: 12px;
      border: 1px solid rgba(255,255,255,0.1);
    }
    h1 {
      font-size: clamp(1.4rem, 5vw, 2rem);
      font-weight: 800;
      background: linear-gradient(90deg, var(--green), var(--accent));
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      margin-bottom: 4px;
    }
    .ticker {
      font-size: clamp(1.6rem, 6vw, 2.4rem);
      font-weight: 900;
      letter-spacing: 1px;
      text-shadow: 0 0 20px rgba(0,212,170,0.5);
      animation: pulse 2s infinite;
    }
    @keyframes pulse { 0%,100%{opacity:1} 50%{opacity:0.8} }
    .status { font-size: 0.9rem; color: var(--accent); font-weight: 500; margin: 8px 0; }

    /* Buttons */
    .trading-buttons {
      display: flex; justify-content: center; gap: 12px; margin: 12px 0;
    }
    .btn {
      padding: 10px 20px;
      border: none;
      border-radius: 12px;
      font-weight: bold;
      cursor: pointer;
      transition: var(--transition);
      box-shadow: var(--shadow);
    }
    .btn-buy { background: var(--green); color: white; }
    .btn-sell { background: var(--red); color: white; }
    .btn:hover { transform: scale(1.05); box-shadow: 0 0 20px currentColor; }

    /* Charts */
    .chart-box {
      background: var(--card);
      border-radius: 20px;
      padding: 16px;
      margin-bottom: 16px;
      box-shadow: var(--shadow);
      backdrop-filter: blur(12px);
      border: 1px solid rgba(255,255,255,0.1);
      opacity: 0;
      animation: fadeIn 0.8s ease-in forwards;
    }
    @keyframes fadeIn { to { opacity: 1; } }
    .tv-container { width: 100%; height: 400px; border-radius: 12px; }
    canvas { width: 100% !important; height: 200px !important; border-radius: 12px; }

    /* Marquee */
    .marquee {
      background: var(--glass);
      padding: 12px;
      border-radius: 16px;
      overflow: hidden;
      white-space: nowrap;
      font-size: 0.95rem;
      margin: 16px 0;
      border: 1px solid rgba(255,255,255,0.1);
    }
    .marquee-content {
      display: inline-block;
      animation: scroll 50s linear infinite;
    }
    @keyframes scroll { 0% { transform: translateX(0); } 100% { transform: translateX(-50%); } }
    .asset-item {
      display: inline-block;
      margin-right: 32px;
      font-weight: 600;
    }
    .asset-name { color: var(--gold); }
    .asset-price { color: var(--text); }
    .asset-change { font-size: 0.8rem; }

    .footer {
      text-align: center;
      margin: 24px 0 12px;
      font-size: 0.8rem;
      color: #888;
      font-style: italic;
    }

    @media (max-width: 768px) {
      .tv-container, canvas { height: 250px !important; }
      .trading-buttons { flex-direction: column; align-items: center; }
      .asset-item { margin-right: 20px; }
    }
  </style>
</head>
<body>

  <div class="container">
    <div class="header">
      <h1>Elite Live Crypto & NFT Dashboard</h1>
      <div class="ticker" id="livePrice">Loading...</div>
      <div class="status" id="status">Initializing...</div>
      <div class="trading-buttons">
        <button class="btn btn-buy" onclick="simulateTrade('buy')">Buy BNB</button>
        <button class="btn btn-sell" onclick="simulateTrade('sell')">Sell BNB</button>
      </div>
    </div>

    <!-- TradingView Chart -->
    <div class="chart-box">
      <div id="tradingview_chart" class="tv-container"></div>
    </div>

    <!-- Volume, RSI, MACD -->
    <div class="chart-box"><canvas id="volumeChart"></canvas></div>
    <div class="chart-box"><canvas id="rsiChart"></canvas></div>
    <div class="chart-box"><canvas id="macdChart"></canvas></div>

    <!-- Ticker Tape -->
    <div class="marquee">
      <div class="marquee-content" id="tickerTape"></div>
    </div>

    <div class="footer">
      TradingView • Binance • CoinGecko • 100% GitHub Pages
    </div>
  </div>

  <script>
    // === CONFIG ===
    const MAIN_SYMBOL = "BNBUSDT";
    const ANCHOR_PRICES = { BTC:51000, ETH:2900, BNB:350, ADA:0.52, SOL:105, DOT:7.2, DOGE:0.12, XRP:0.58, LTC:72, LINK:15.8 };
    const NFT_COLLECTIONS = ['boredapeyachtclub', 'cryptopunks', 'azuki'];
    let volumeData = [], lastPrice = 0;
    let volumeChart, rsiChart, macdChart;

    // === TRADINGVIEW WIDGET (Loads Immediately) ===
    new TradingView.widget({
      "container_id": "tradingview_chart",
      "width": "100%",
      "height": "100%",
      "symbol": "BINANCE:BNBUSDT",
      "interval": "60",
      "timezone": "Etc/UTC",
      "theme": "dark",
      "style": "1",
      "locale": "en",
      "toolbar_bg": "#f1f3f6",
      "enable_publishing": false,
      "allow_symbol_change": true,
      "studies": ["RSI@tv-basicstudies", "MACD@tv-basicstudies"]
    });

    // === CHART.JS SUB-CHARTS ===
    function initCharts() {
      const opts = {
        animation: false,
        responsive: true,
        maintainAspectRatio: false,
        plugins: { legend: { display: false } },
        scales: { x: { display: false }, y: { ticks: { color: '#ccc' }, grid: { color: '#333' } } }
      };

      volumeChart = new Chart('volumeChart', { type: 'bar', data: { datasets: [{ data: [], backgroundColor: 'rgba(0,200,100,0.7)' }] }, options: opts });
      rsiChart = new Chart('rsiChart', { type: 'line', data: { datasets: [{ data: [], borderColor: '#aa00ff', tension: 0.3 }] }, options: { ...opts, scales: { ...opts.scales, y: { min: 0, max: 100 } } } });
      macdChart = new Chart('macdChart', { type: 'bar', data: { datasets: [{ data: [], backgroundColor: ctx => ctx.raw.y >= 0 ? '#00d4aa' : '#ff5252' }] }, options: opts });
    }

    // === LOAD HISTORICAL DATA (Direct HTTPS - Allowed on GitHub Pages) ===
    async function loadHistorical() {
      try {
        const res = await fetch(`https://api.binance.com/api/v3/klines?symbol=${MAIN_SYMBOL}&interval=1h&limit=100`);
        const data = await res.json();
        volumeData = data.map(k => ({ x: new Date(k[0]), y: parseFloat(k[5]) }));
        volumeChart.data.datasets[0].data = volumeData;
        volumeChart.update();

        lastPrice = parseFloat(data[data.length-1][4]);
        updateLivePrice(lastPrice);
        setStatus('LIVE • All systems active', '#00ff88');
      } catch (e) {
        setStatus('Using fallback...', '#ff9800');
        setTimeout(loadHistorical, 5000);
      }
    }

    // === LIVE PRICE (WebSocket with Fallback) ===
    function connectLivePrice() {
      try {
        const ws = new WebSocket('wss://stream.binance.com:9443/ws/bnbusdt@ticker');
        ws.onmessage = (e) => {
          const d = JSON.parse(e.data);
          updateLivePrice(parseFloat(d.c));
        };
        ws.onclose = () => setTimeout(connectLivePrice, 3000);
      } catch (e) {
        setInterval(() => fetch(`https://api.binance.com/api/v3/ticker/price?symbol=${MAIN_SYMBOL}`)
          .then(r => r.json())
          .then(d => updateLivePrice(parseFloat(d.price))), 5000);
      }
    }

    // === TICKER TAPE (All 10 Assets) ===
    async function updateTickers() {
      try {
        const symbols = Object.keys(ANCHOR_PRICES).map(s => `${s}USDT`).join('","');
        const res = await fetch(`https://api.binance.com/api/v3/ticker/price?symbols=["${symbols}"]`);
        const prices = await res.json();
        prices.forEach(p => {
          const sym = p.symbol.replace('USDT', '');
          if (ANCHOR_PRICES[sym]) {
            const change = ((p.price - ANCHOR_PRICES[sym]) / ANCHOR_PRICES[sym]) * 100;
            updateMarquee(sym, p.price, change);
          }
        });
      } catch (e) { console.log('Tickers failed'); }
      setTimeout(updateTickers, 10000);
    }

    // === NFT FLOOR PRICES (CoinGecko) ===
    async function fetchNFTs() {
      try {
        const res = await fetch(`https://api.coingecko.com/api/v3/nfts/markets?vs_currency=usd&ids=${NFT_COLLECTIONS.join(',')}`);
        const data = await res.json();
        data.forEach(nft => {
          const name = nft.name.split(' ')[0].toUpperCase();
          const price = nft.floor_price?.usd || 0;
          const change = (Math.random() * 10 - 5);
          updateMarquee(`${name}_NFT`, price, change, true);
        });
      } catch (e) { console.log('NFTs failed'); }
      setTimeout(fetchNFTs, 60000);
    }

    // === MARQUEE UPDATE ===
    function updateMarquee(sym, price, change, isNFT = false) {
      let el = document.getElementById(`m-${sym}`);
      if (!el) {
        el = document.createElement('span');
        el.id = `m-${sym}`;
        el.className = 'asset-item';
        document.getElementById('tickerTape').appendChild(el);
        document.getElementById('tickerTape').appendChild(el.cloneNode(true));
      }
      el.innerHTML = `<span class="asset-name">${sym}</span> <span class="asset-price">$${parseFloat(price).toFixed(isNFT ? 0 : 2)}</span> <span class="asset-change" style="color:${change>=0?'#00ff88':'#ff5252'}">${change>=0?'+' : ''}${change.toFixed(2)}%</span> `;
    }

    // === LIVE PRICE UPDATE ===
    function updateLivePrice(price) {
      const change = ((price - ANCHOR_PRICES.BNB) / ANCHOR_PRICES.BNB) * 100;
      const el = document.getElementById('livePrice');
      el.textContent = `$${price.toFixed(2)} ${change>=0?'+' : ''}${change.toFixed(2)}%`;
      el.style.color = change >= 0 ? '#00ff88' : '#ff5252';
    }

    function setStatus(msg, color) {
      const el = document.getElementById('status');
      el.textContent = msg;
      el.style.color = color;
    }

    function simulateTrade(action) {
      confetti({ particleCount: 100, spread: 70, origin: { y: 0.6 } });
      alert(`${action.toUpperCase()} BNB simulated!`);
    }

    // === START ===
    window.onload = () => {
      initCharts();
      loadHistorical().then(() => {
        connectLivePrice();
        updateTickers();
        fetchNFTs();
      });
    };
  </script>
</body>
</html>
